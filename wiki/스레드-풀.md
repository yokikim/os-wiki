---

layout: page
title: 스레드 풀

---

195p

[다중 스레드](다중-스레드.html) 페이지 참고

[4.1절](https://github.com/yokikim/osdinostudy_1/wiki/%EB%8B%A4%EC%A4%91-%EC%8A%A4%EB%A0%88%EB%93%9C#%EB%8F%99%EA%B8%B0-motivation)에서 우리는 다중 스레드로 구성된 웹브라우저를 설명하였다.

그러한 웹 서버는 요청을 받을 때마다 그 요청을 위해 새로운 스레드를 만들어 준다.

새로운 스레드를 매 요청마다 만들어주는 것은, 그때마다 새로운 프로세스를 만들어주는 것보다 확실히 더 진보된 방법임을 틀림없지만, 다중 스레드 서버는 아직도 여러 문제를 가지고 있다.

첫 번째 문제는 서비스할 때마다 스레드를 생성하는 데 소요되는 시간이다. - 특히 이 스레드는 이 일만 끝나면 곧장 용도 폐기될 것이라는 점을 염두에 두면 더 그렇다.

두 번째 이슈는 더 심각한 문제이다.

모든 요처마다 새 스레드를 만들어서 서비스해 준다면 시스템에서 동시에 실행할 수 있는 최대 스레드 수가 몇 개까지 가능할 수 있는 것인지 한계를 정해야 한다.

스레드를 무한정 만들면 언젠가는 CPU 시간, 메모리 공간 같은 시스템 자원이 고갈된다.

이러한 문제들을 해결해 줄 수 있는 방법의 하나가 스레드 풀(pool)이다.

...

스레드 풀의 기본 아이디어는 프로세스를 시작할 때 아예 일정한 수의 스레드들을 미리 풀로 만들어두는 것이다.

이 스레드들은 평소에는 하는 일 없이 일감을 기다리게 된다.

서버는 스레드를 생성하지 않고 요청을 받으면 대신 스레드 풀에 제출하고 추가 요청 대기를 재개한다.

풀에 사용 가능한 스레드가 있으면 깨어나고 요청이 즉시 서비스 된다.

풀에 사용 가능한 스레드가 없으면 사용 가능한 스레드가 생길 때까지 작업이 대기된다.

스레드가 서비스를 완료하면 풀로 돌아가서 더 많은 작업을 기다린다.

풀에 제출 된 작업을 비동기적으로 실행할 수 있는 경우 스레드 풀이 제대로 작동한다.

### 스레드 풀의 장점

1. 새 스레드를 만들어 주기보다 기존 스레드로 서비스해 주는 것이 종종 더 빠르다.
2. 스레드 풀은 임의 시각에 존재할 스레드 개수에 제한을 둔다. 이러한 제한은 많은 수의 스레드를 병렬 처리할 수 없는 시스템에 도움이 된다.
3. 태스크를 생성하는 방법은 태스크로부터 분리하면 태스크를 실행할 다르게 할 수 있다. 예를 들면 태스크를 일정 시간 후에 실행되도록 스케줄 하거나 혹은 주기적으로 실행시킬 수 있다.

...

스레드 풀에 있는 스레드의 개수는 CPU 수, 물리 메모리 용량, 동시 요청 클라이언트 최대 개수 등을 고려하여 정해질 수 있다.

더 정교하게 하려면 풀의 활용도를 보며 동적으로 풀의 크기를 바꾸어줄 수도 있다.

그러한 구조는 시스템 부하가 적을 때에는 더 작은 풀을 유지하도록 함으로써 메모리 을의 소모를 더 줄일 수 있다.