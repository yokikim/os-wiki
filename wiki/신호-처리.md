[[스레드와 관련된 문제들]]

신호는 UNIX에서 프로세스에 어떤 이벤트가 일어났음을 알려주기 위해 사용된다.

신호는 알려줄 이벤트의 근원지나 이유에 따라 [[동기식|동기식 신호]] 또는 [[비동기식|비동기식 신호]]으로 전달될 수 있다.

동기식이건 비동기식이건 모든 신호는 다음과 같은 형태로 전달된다.

1. 신호는 특정 이벤트가 일어나야 생성된다.
2. 생성된 신호가 프로세스에 전달된다.
3. 신호가 전달되면 반드시 처리되어야 한다.

### 신호 처리기

모든 신호는 둘 중 하나의 처리기에 의해 처리된다.

1. 디폴트 신호 처리기
2. 사용자 정의 신호 처리기

모든 신호마다 커널이 실행시키는 디폴트 신호 처리기가 있다.

이 디폴트 처리기는 신호를 처리하기 위하여 호출되는 사용자 정의 처리기에 의해 대체될 수 있다.

신호는 다른 방식으로 처리될 수 있다.

일부 신호는 무시될 수 있지만 다른신호(예: 불법 메모리 엑세스)는 프로그램을 종료하여 처리된다.

### 단일 및 다중 스레드에서의 신호 처리

단일 스레드 프로그램에서의 신호 처리는 간단하다.

신호는 항상 프로세스에 전달된다.

그러나 프로세스가 여러 스레드를 가지고 있는 다중 스레드 프로그램에서의 신호 처리는 더욱 복잡하다.

어느 스레드에 신호를 전달해야 하는가?

...

일반적으로 다음과 같은 선택이 존재한다.

1. 신호가 적용될 스레드에게 전달한다.
2. 모든 스레드에 전달된다.
3. 몇몇 스레드들에만 선택적으로 전달한다.
4. 특정 스레드가 모든 신호를 전달받도록 지정한다.

### 신호를 전달하는 방법

신호를 전달하는 방법은 신호의 유형에 따라 다르다.

예를 들어 [[동기식 신호]]는 그 신호를 야기한 스레드에 전달되어야 하고 다른 스레드에 전달되면 안 된다.

그러나 [[비동기식 신호]]의 경우는 명확하지 않다.

control+C 같은 키를 쳐서 그 프로세스를 강제 종료하는 신호와 같은 어떤 비동기식 신호는 그 프로세스 내 모든 스레드에 전달되어야 한다,

신호를 전달하는 데 사용되는 표준 UNIX 함수는

    kill(pid_t pid, int signal)

이다.

이 함수는 특정 신호가 전달될 프로세스(pid)를 지정한다.

대부분의 다중 스레드 UNIX는 스레드에 받아들일 신호와 봉쇄할 신호를 지정할 수 있는 선택권을 준다.

따라서 어떤 경우에는 비동기식 신호를 봉쇄하지 않고 있는 스레드들에게만 신호를 전달해야 할 수 있다.

하지만 신호는 오직 한 번만 처리되어야 하기 때문에 그 신호를 봉쇄하지 않고 있는 첫 번째 스레드에만 신호를 전달된다.

POSIX Pthreads는 tid로 지정된 스레드에만 전달이 되도록 허용하는 다음과 같은 함수를 제공한다.

    pthread_kill(pthread_t tid, int signal)

Windows는 신호를 명시적으로 지원하지는 않지만 비동기식 프로시저 호출(asynchronus procedure calls, APC)이라는 것을 사용해서 대리 실행(emulate) 할 수 있다.

APC는 사용자 스레드들이 특정 이벤트의 발생을 전달받았을 때 호출될 함수를 지정할 수 있게 한다.

이름이 의미하는 바와 같이 APC는 UNIX의 비동기식 신호와 유사하다.

그러나 UNIX에서는 다중 스레드 환경에서 신호를 어떻게 처리해야 할지를 고민해야 하지만 APC는 프로세스에 전달되는 것이 아니라 특정 스레드에 전달되기 때문에 좀 더 간단하다.