---
layout: page
title: 디스패처
parent: 디스패치
---
### 디스패처

CPU 스케줄링 기능에 포함된 또 하나의 요소는 **디스패처**(dispatcher)이다. 디스패처는 CPU 코어의 제어를 CPU 스케줄러가 선택한 프로세스에 주는 모듈이며 다음과 같은 작업을 포함한다.

- 한 프로세스에서 다른 프로세스로 문맥을 교환하는 일
- 사용자 모드로 전환하는 일
- 프로그램을 다시 시작하기 위해 사용자 프로그램의 적절한 위치로 이동(jump)하는 일

디스패처는 모든 프로세스의 문맥 교환 시 호출되므로, 가능한 한 최고로 빨리 수행되어야 한다.

### 디스패처 지연

디스패처가 하나의 프로세스를 정지하고 다른 프로세스의 수행을 시작하는 데까지 소요되는 시간을 디스패치 지연(diapatch latency)이라고 하고 다음 그림에 묘사되어 있다.

![image](https://user-images.githubusercontent.com/116250393/216228666-a167f664-769d-43d7-84ce-c15921bfa9a9.png)

### 문맥교환

…

고려해야 할 흥미로운 질문은 “문맥 교환이 얼마나 자주 발생하는가?” 이다.

시스템 차원에서 Linux 시스템에서 제공되는 `vmstat` 명령을 사용하여 문맥 교환 횟수를 얻을 수 있다.

아래는 명령의 출력(일부만 추려낸)이다.

`vmstat 1 3`

이 명령은 1-초 지연 단위로 3줄의 출력을 제공한다.

```bash
------cpu-----
24
225
339
```

첫번째 줄은 시스템 부팅 이후 1초 단위의 평균 문맥 교환 횟수를 제공하고, 다음 두 줄은 두 개의 1초 동안 문맥 교환 횟수를 제공한다.

이 기기가 부팅된 이후 초당 평균 24번의 문맥 교환을 하였다.

그리고 직전 1초 동안 225번의 문맥 교환이 이루어졌으며, 그 이전 1초 동안 339번의 문맥 교환이 이루어졌다.

…

`/proc` 파일 시스템을 사용하여 특정 프로세스에 대한 문맥 교환 횟수를 결정할 수도 있다.

예를 들어,  `/proc/2166/status` 파일의 내용은 `pid = 2166` 인 프로세스에 대한 다양한 통계를 보여준다.

명령

`cat /proc/2166/status`

는 다음과 같은 간추려진 출력을 제공한다.

```bash
	voluntary_ctxt_switches      150
	nonvoluntary_ctxt_switches   8
```

이 출력은 프로세스 수명 동안 문맥 교환 횟수를 보여준다. 

***자발적*** 문맥 교환과 ***비자발적*** 문맥 교환의 차이점에 주목하라.

자발적 문맥 교환은 현재 사용 불가능한 자원(예, I/O를 기다리며 봉쇄됨)을 요청했기 때문에 프로세스가 CPU 제어를 포기한 경우 발생한다.

비자발적 문맥 교환은 타임 슬라이스가 만료되었거나 우선순위가 더 높은 프로세스에 의해 선점된 경우와 같이 CPU를 빼앗겼을 때 발생한다.
